---
title: "Support Vector Machines"
author: "Seif Kungulio"
date: "04/14/2025"
output:
  rmdformats::readthedown
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Install necessary packages if not installed
if (!requireNamespace("e1071", quietly = TRUE)) {
  install.packages("e1071")
}
if (!requireNamespace("caret", quietly = TRUE)) {
  install.packages("caret")
}

# Load necessary libraries
library(e1071)
library(caret)
```
<hr style="height:5px; border:none; color:#006000; background-color:#006000;" />

# **Forecast Bike Rental Demand**
<hr style="height:2px; border:none; color:#333; background-color:#333;" />

You are working as a data scientist for the government in the city of Washington, D.C. Currently, Washington, D.C has a bike sharing system. People could rent a bike from one location and return it to a different place. You are given a historical usage pattern with weather data contained in the Excel workbook bike.csv. You are asked to forecast bike rental demand in the capital bike share program.

**Data Source:** from Kaggle at https://www.kaggle.com/c/bike-sharing-demand


## **Data Dictionary**
This dataset contains the following columns:

| **Variable** | **Description** | **Data Type** | **Rules/Constraints** |
|:-------------|:----------------|:--------------|:----------------------|
| **`datetime`** | Date and time of the observation | Timestamp | Must be unique and in ISO 8601 format (YYYY-MM-DD HH:MM:SS). |
| **`season`** | Season (1: Winter, 2: Spring, 3: Summer, 4: Fall) | Categorical | Must be an integer between 1 and 4. |
| **`holiday`** | Whether the day is a holiday (0: No, 1: Yes) | Binary | Must be 0 or 1. |
| **`workingday`** | Whether the day is a working day (0: No, 1: Yes) | Binary | Must be 0 or 1. |
| **`weather`** | Weather condition (1 to 4, where 1: Clear, 4: Extreme) | Categorical | Must be an integer between 1 and 4. |
| **`temp`** | Normalized temperature in Celsius | Continuous | Must be between 0 and 41. |
| **`atemp`** | Normalized "feels like" temperature in Celsius | Continuous | Must be between 0 and 45.455. |
| **`humidity`** | Relative humidity (%) | Continuous | Must be between 0 and 100. |
| **`windspeed`** | Wind speed in km/h | Continuous | Must be non-negative, and maximum value is approximately 56.9979. |
| **`casual`** | Number of casual (non-registered) users | Integer | Must be non-negative, with a maximum of 367. |
| **`registered`** | Number of registered users | Integer | Must be non-negative, with a maximum of 886. |
| **`count`** | Total number of bike rentals | Integer | Must equal casual + registered, and be non-negative. |

<br>

## **Question 1**
Load the dataset bike.csv into memory. Convert holiday to a factor using factor() function. Then split the data into training set containing 2/3 of the original data (test set containing remaining 1/3 of the original data).

Read the dataset into memory
```{r}
Bike.df <- read.csv("data/Bike.csv")
```

Display the dimensions of the data frame (number of rows and columns)
```{r}
dim(Bike.df)
```

Display the column names of the data frame
```{r}
colnames(Bike.df)
```

Display the first six rows of the data frame to understand its structure
```{r}
head(Bike.df)
```

Convert categorical variables to factors
```{r}
# 
Bike.df$season = factor(Bike.df$season,
                        levels = c(1, 2, 3, 4),
                        labels = c("Spring", "Summer", "Fall", "Winter")
)

Bike.df$holiday <- factor(Bike.df$holiday, 
                          levels = c(0,1), 
                          labels = c("Non-Holiday", "Holiday")
)

Bike.df$workingday <- factor(Bike.df$workingday,
                             levels = c(0,1), 
                             labels = c("Non-Workingday", "Workingday")
)

Bike.df$weather <- factor(Bike.df$weather,
                          levels = c(1, 2, 3, 4),
                          labels = c("Clear", "Misty_cloudy",
                                     "Light_snow", "Heavy_rain")
)
```

Split the data into a training set (2/3) and test set (1/3)
```{r}
# Set seed for reproducibility
set.seed(1)

# Create train index that will contain 2/3 of the dataset
trainIdx = sample(1:nrow(Bike.df), size = 2/3 * nrow(Bike.df))

# Create a training dataset out of "Bike.df"
trainData = Bike.df[trainIdx, ]

# Create a testing dataset from the remaining dataset of "Bike.df"
testData  <- Bike.df[-trainIdx, ]
```

Check the dimension of training dataset and testing dataset
```{r}
# Check the dimension of training dataset
dim(trainData)

# Check the dimension of testing dataset
dim(testData)
```

<hr>

## **Question 2**
**Build a support vector machine model.**

### **Section A**
The response is `holiday` and the predictors are: `season`, `workingday`, `casual`, and `registered`. Please use `svm()` function with radial kernel and gamma = 10 and cost = 100.
```{r}
svm.model <- svm(holiday ~ season + workingday + casual + registered,
                 data = trainData,
                 kernel = "radial",
                 gamma = 10,
                 cost = 100)
summary(svm.model)
```

### **Section B**
Perform a grid search to find the best model with potential cost: 1, 10, 50, 100 and potential gamma: 1, 3, and 5 and using radial kernel and training dataset.
```{r}
tuned.results <- tune(svm, holiday ~ season + workingday + casual + registered, 
                     data = trainData, kernel = "radial", 
                     ranges = list(cost = c(1, 10, 50, 100), 
                                   gamma = c(1, 3, 5)
                     ))
summary(tuned.results)
```

### **Section C**
Print out the model results. Whatâ€™s the best model parameters?
```{r}
best_tuned.model <- tuned.results$best.model
summary(best_tuned.model)
```

### **Section D**
Forecast `holiday` using the test dataset and the best model found in c).
```{r}
predictions <- predict(best_tuned.model, newdata = testData)
summary(predictions)
```

### **Section E**
Get the true observations of `holiday` in the test dataset.
```{r}
#observations <- testData$holiday
actuals <- Bike.df[-trainIdx, "holiday"]
summary(actuals)
```

### **Section F**
Compute the test error by constructing the confusion matrix. Is it a good model?
```{r}
conf.matrix <- confusionMatrix(predictions, actuals)
print(conf.matrix)
```
